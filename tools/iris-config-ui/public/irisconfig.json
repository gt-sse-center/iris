{
  "$defs": {
    "IrisBingView": {
      "properties": {
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Further description which explains what the user can see in this view.  Examples:\n\"views\": {\n  ...\n  \"Bing\": {\n      \"description\": \"Aerial Imagery\",\n      \"type\": \"bingmap\"\n  }\n}\n```\n",
          "title": "Description"
        },
        "type": {
          "const": "bingmap",
          "default": "bingmap",
          "title": "Type",
          "type": "string"
        }
      },
      "title": "IrisBingView",
      "type": "object"
    },
    "IrisImages": {
      "properties": {
        "path": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "additionalProperties": {
                "type": "string"
              },
              "type": "object"
            }
          ],
          "description": "The input path to the images. Can be either a string containing an existing path with the\nplaceholder `{id}` or a dictionary of paths with the placeholder `{id}` (see examples below). The placeholder will be replaced by the unique id of\nthe current image. IRIS can load standard image formats (like *png* or *tif*), theoretically all kind of files that can be opened by GDAL/rasterio\n(such as *geotiff* or *vrt*) and numpy files (*npy*). The arrays inside the numpy files should have the shape HxWxC. Examples:\n\nWhen you have one folder `images` containing your images in *tif* format:\n```\n\"path\": \"images/{id}.tif\"\n```\n\nWhen you have one folder `images` containing subfolders with your images in *tif* format:\n```\n\"path\": \"images/{id}/image.tif\"\n```\n\nWhen you have your data distributed over multiple files (e.g. coming from Sentinel-1 and Sentinel-2), you can use a dictionary for each file type. The keys of the dictionary are file identifiers which are important for the [views](#views) configuration.\n```\n\"path\": {\n    \"Sentinel1\": \"images/{id}/S1.tif\",\n    \"Sentinel2\": \"images/{id}/S2.tif\"\n}\n```\n",
          "title": "Path"
        },
        "shape": {
          "default": null,
          "description": "The shape of the images. Must be a list of width and height. Example: `[512, 512]`",
          "items": {
            "type": "integer"
          },
          "maxItems": 2,
          "minItems": 2,
          "title": "Shape",
          "type": "array"
        },
        "thumbnails": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": false,
          "description": "Optional thumbnail files for the images. Path must contain a placeholder `{id}`. If you cannot provide any thumbnail, just leave it out or set it to `False`. Example: `thumbnails/{id}.png`",
          "title": "Thumbnails"
        },
        "metadata": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": false,
          "description": "Optional metadata for the images. Path must contain a placeholder `{id}`. Metadata files\ncan be in json, yaml or another text file format. json and yaml files will be parsed and made accessible via the GUI. If the metadata contains the\nkey `location` with a list of two floats (longitude and latitude), it can be used for a bingmap view. If you cannot provide any metadata, just\nleave it out or set it to `false`. Example field: `metadata/{id}.json` . Example file contents:\n```\n{\n    \"spacecraft_id\": \"Sentinel2\",\n    \"scene_id\": \"coast\",\n    \"location\": [-26.3981, 113.3077],\n    \"resolution\": 20.0\n}\n```\n",
          "title": "Metadata"
        }
      },
      "required": [
        "path"
      ],
      "title": "IrisImages",
      "type": "object"
    },
    "IrisMonochromeView": {
      "properties": {
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Further description which explains what the user can see in this view. Examples:\n```\n\"views\": {\n  ...\n  \"Cirrus\": {\n      \"description\": \"Cirrus and high clouds are red.\",\n      \"type\": \"image\",\n      \"data\": \"$Sentinel2.B11**0.8*5\",\n      \"cmap\": \"jet\"\n  },\n  \"Cirrus-Edges\": {\n      \"description\": \"Edges in the cirrus band\",\n      \"type\": \"image\",\n      \"data\": \"edges($Sentinel2.B11**0.8*5)*1.5\",\n      \"cmap\": \"gray\"\n  },\n  \"Superpixels\": {\n      \"description\": \"Superpixels in the panchromatic bands\",\n      \"type\": \"image\",\n      \"data\": \"superpixels($Sentinel2.B2+$Sentinel2.B3+$Sentinel2.B4, sigma=4, min_size=100)\",\n      \"cmap\": \"jet\"\n  },\n}\n```\n",
          "title": "Description"
        },
        "type": {
          "const": "image",
          "default": "image",
          "title": "Type",
          "type": "string"
        },
        "data": {
          "description": "Expression for a monochrome image built from one or more valid band arrays referenced as\n`$B<band-number-in-file-1-indexed>` (simple string for image:path) or `$<file-identifier>.$B<band-number-in-file-1-indexed>` (dictionary supplied for image:path). Examples: `$B1`, `$Sentinel2.B1`. It can contain mathematical expressions, band combinations, or calls to specific numpy or skimage functions like `mean` (`np.mean`), `edges` (`skimage.sobel`) or `superpixels` (`skimage.felzenszwalb`). Aliased list: ['max', 'max', 'mean', 'median', 'log', 'exp', 'sin', 'cos', 'PI', 'edges', 'superpixels'] . It can contain mathematical expressions, band combinations, or calls to specific numpy or skimage functions like `mean` (`np.mean`), `edges` (`skimage.sobel`) or `superpixels` (`skimage.felzenszwalb`). Aliased list: ['max', 'max', 'mean', 'median', 'log', 'exp', 'sin', 'cos', 'PI', 'edges', 'superpixels'] .",
          "title": "Data",
          "type": "string"
        },
        "cmap": {
          "default": "jet",
          "description": "Matplotlib colormap name to render monochrome image.",
          "title": "Cmap",
          "type": "string"
        },
        "clip": {
          "anyOf": [
            {
              "description": "By default, bands are stretched between 0 and 1, relative to their\nminimum and maximum values. By setting a value for clip, you control the percentile of pixels that are saturated at 0 and 1, which can be helpful\nif there are some extreme pixel values that reduce the contrast in other parts of the image.",
              "maximum": 100,
              "minimum": 0,
              "type": "number"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Clip"
        },
        "vmin": {
          "anyOf": [
            {
              "description": "If you know the precise low value you would like to clip the pixel values to, (rather than a percentile), then you can specify this with vmin (optionally used with `vmax`). This cannot be used for the same view as `clip`.",
              "type": "number"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Vmin"
        },
        "vmax": {
          "anyOf": [
            {
              "description": "If you know the precise high value you would like to clip the pixel values to, (rather than a percentile), then you can specify this with vmax (optionally used with `vmin`). This cannot be used for the same view as `clip`.",
              "type": "number"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Vmax"
        }
      },
      "required": [
        "data"
      ],
      "title": "IrisMonochromeView",
      "type": "object"
    },
    "IrisRGBView": {
      "properties": {
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Further description which explains what the user can see in this view.  Examples:\n```\n\"views\": {\n  ...\n  \"RGB\": {\n      \"description\": \"Normal RGB image.\",\n      \"type\": \"image\",\n      \"data\": [\"$Sentinel2.B5\", \"$Sentinel2.B3\", \"$Sentinel2.B2\"]\n  },\n  \"Sentinel-1\": {\n      \"description\": \"RGB of VH, VV and VH-VV.\",\n      \"type\": \"image\",\n      \"data\": [\"$Sentinel1.B1\", \"$Sentinel1.B2\", \"$Sentinel1.B1-$Sentinel1.B2\"]\n  },\n}\n```\n",
          "title": "Description"
        },
        "type": {
          "const": "image",
          "default": "image",
          "title": "Type",
          "type": "string"
        },
        "data": {
          "description": "Expression for the three tracks for an RGB image built from one or more valid band arrays referenced as {_view_band_dat    a_description} {_aliased_view_fn_description}",
          "items": {
            "type": "string"
          },
          "maxItems": 3,
          "minItems": 3,
          "title": "Data",
          "type": "array"
        },
        "clip": {
          "anyOf": [
            {
              "description": "By default, bands are stretched between 0 and 1, relative to\ntheir minimum and maximum values. By setting a value for clip, you control the percentile of pixels that are saturated at 0 and 1, which can be\nhelpful if there are some extreme pixel values that reduce the contrast in other parts of the image.",
              "maximum": 100,
              "minimum": 0,
              "type": "number"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Clip"
        },
        "vmin": {
          "anyOf": [
            {
              "description": "If you know the precise low value you would like to clip the pixel values to, (rather than a percentile), then you can specify this with vmin (optionally used with `vmax`). This cannot be used for the same view as `clip`.",
              "type": "number"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Vmin"
        },
        "vmax": {
          "anyOf": [
            {
              "description": "If you know the precise high value you would like to clip the pixel values to,\n(rather than a percentile), then you can specify this with vmax (optionally used with `vmin`). This cannot be used for the same view as `clip`.",
              "type": "number"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Vmax"
        }
      },
      "required": [
        "data"
      ],
      "title": "IrisRGBView",
      "type": "object"
    },
    "IrisSegAIModel": {
      "properties": {
        "bands": {
          "title": "Bands",
          "type": "null"
        },
        "train_ratio": {
          "default": 0.8,
          "title": "Train Ratio",
          "type": "number"
        },
        "max_train_pixels": {
          "default": 20000,
          "title": "Max Train Pixels",
          "type": "integer"
        },
        "n_estimators": {
          "default": 20,
          "title": "N Estimators",
          "type": "integer"
        },
        "max_depth": {
          "default": 10,
          "title": "Max Depth",
          "type": "integer"
        },
        "n_leaves": {
          "default": 10,
          "title": "N Leaves",
          "type": "integer"
        },
        "suppression_threshold": {
          "default": 0,
          "title": "Suppression Threshold",
          "type": "integer"
        },
        "suppression_filter_size": {
          "default": 5,
          "title": "Suppression Filter Size",
          "type": "integer"
        },
        "suppression_default_class": {
          "default": 0,
          "title": "Suppression Default Class",
          "type": "integer"
        },
        "use_edge_filter": {
          "default": false,
          "title": "Use Edge Filter",
          "type": "boolean"
        },
        "use_superpixels": {
          "default": false,
          "title": "Use Superpixels",
          "type": "boolean"
        },
        "use_meshgrid": {
          "default": false,
          "title": "Use Meshgrid",
          "type": "boolean"
        },
        "meshgrid_cells": {
          "default": "3x3",
          "title": "Meshgrid Cells",
          "type": "string"
        }
      },
      "required": [
        "bands"
      ],
      "title": "IrisSegAIModel",
      "type": "object"
    },
    "IrisSegClass": {
      "properties": {
        "name": {
          "description": "Name of the class.",
          "title": "Name",
          "type": "string"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Further description which explains the user more about the class (e.g. why is it different from another class, etc.)",
          "title": "Description"
        }
      },
      "required": [
        "name"
      ],
      "title": "IrisSegClass",
      "type": "object"
    },
    "IrisSegmentationConfig": {
      "properties": {
        "path": {
          "description": "This directory will contain the mask files from the segmentation. Four different mask formats are\nallowed: *npy*, *tif*, *png* or *jpeg*. Example:\n\nThis will create a folder next to the project file called `masks` containing the mask files in *png* format.\n```\n\"path\": \"masks/{id}.png\"\n```\n",
          "title": "Path",
          "type": "string"
        },
        "mask_encoding": {
          "$ref": "#/$defs/SegMaskEnum",
          "default": "rgb",
          "description": "The encodings of the final masks. Can be `integer`, `binary`, `rgb` or `rgba`. Note:\nnot all mask formats support all encodings. Example: `\"mask_encoding\": \"rgb\"`."
        },
        "mask_area": {
          "anyOf": [
            {
              "items": {
                "type": "integer"
              },
              "maxItems": 4,
              "minItems": 4,
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "In case you don't want to allow the user to label the complete image, you can\nlimit the segmentation area. Example: `\"mask_area\": [100, 100, 400, 400]`",
          "title": "Mask Area"
        },
        "score": {
          "$ref": "#/$defs/SegScoreEnum",
          "default": "f1",
          "description": "Defines how to measure the score achieved by the user for each mask. Can be `f1`, `jaccard`\nor `accuracy`. Example: `\"score\": \"f1\"`."
        },
        "prioritise_unmarked_images": {
          "default": true,
          "description": "Mode to serve up images with the lowest number of annotations when user asks for\nnext image.",
          "title": "Prioritise Unmarked Images",
          "type": "boolean"
        },
        "unverified_threshold": {
          "default": 1,
          "description": "TODO Number of unverified users contributing masks above which to tag an image\n\"unverified\".",
          "minimum": 0,
          "title": "Unverified Threshold",
          "type": "integer"
        },
        "ai_model": {
          "$ref": "#/$defs/IrisSegAIModel"
        }
      },
      "required": [
        "path",
        "ai_model"
      ],
      "title": "IrisSegmentationConfig",
      "type": "object"
    },
    "SegMaskEnum": {
      "description": "Allowed encodings for final masks. Not all mask formats support all encodings.",
      "enum": [
        "integer",
        "binary",
        "rgb",
        "rgba"
      ],
      "title": "SegMaskEnum",
      "type": "string"
    },
    "SegScoreEnum": {
      "description": "Allowed score measure.",
      "enum": [
        "f1",
        "jaccard",
        "accuracy"
      ],
      "title": "SegScoreEnum",
      "type": "string"
    }
  },
  "properties": {
    "name": {
      "description": "Optional name for this project. (e.g., `cloud-segmentation`)",
      "title": "Name",
      "type": "string"
    },
    "port": {
      "default": 5000,
      "description": "Set the port on which IRIS is served. Example: `6060`.",
      "maximum": 65535,
      "minimum": 0,
      "title": "Port",
      "type": "integer"
    },
    "host": {
      "default": "127.0.0.1",
      "description": "Set the host IP address for IRIS. The default value 127.0.0.1 means IRIS will only be visible on the local machine. If you want to expose IRIS publicly as a web application, we recommend setting the host to 0.0.0.0 and adjusting your router / consulting with your network administrators accordingly.",
      "examples": [
        "127.0.0.1",
        "0.0.0.0"
      ],
      "title": "Host",
      "type": "string"
    },
    "images": {
      "$ref": "#/$defs/IrisImages",
      "description": "A dictionary which defines the inputs. Example:\n```\n\"images\": {\n      \"path\": \"images/{id}/image.tif\",\n      \"shape\": [512, 512],\n      \"thumbnails\": \"images/{id}/thumbnail.png\",\n      \"metadata\": \"images/{id}/metadata.json\"\n  }\n```\n"
    },
    "classes": {
      "description": "This is a list of classes that you want to allow the user to label.\nExamples:\n\n    {\n        \"name\": \"Clear\",\n        \"description\": \"All clear pixels.\",\n        \"colour\": [255,255,255,0],\n        \"user_colour\": [0,255,255,70]\n    },\n    {\n        \"name\": \"Cloud\",\n        \"description\": \"All cloudy pixels.\",\n        \"colour\": [255,255,0,70]\n    }\n]\n",
      "items": {
        "$ref": "#/$defs/IrisSegClass"
      },
      "minItems": 1,
      "title": "Classes",
      "type": "array"
    },
    "views": {
      "additionalProperties": {
        "anyOf": [
          {
            "$ref": "#/$defs/IrisMonochromeView"
          },
          {
            "$ref": "#/$defs/IrisRGBView"
          },
          {
            "$ref": "#/$defs/IrisBingView"
          }
        ]
      },
      "description": "Since this app was developed for\nmulti-spectral satellite data (i.e. images with more than just three channels), you can decide how to present the images to the user. This\noption must be a dictionary where each key is the name of the view and the value another dictionary containing properties for the view.",
      "minProperties": 1,
      "title": "Views",
      "type": "object"
    },
    "view_groups": {
      "additionalProperties": {
        "items": {
          "type": "string"
        },
        "type": "array"
      },
      "description": "Views are displayed in groups. In the GUI of IRIS, you will be able to switch\nbetween different groups quickly. The group `default` must always be set, further groups are optional. Examples:\n```\n\"view_groups\": {\n      \"default\": [\"Cirrus\", \"RGB\", \"Bing\"],\n      \"clouds\": [\"Cirrus\"],\n      \"radar\": [\"Sentinel1\"]\n  }\n```\n",
      "title": "View Groups",
      "type": "object"
    },
    "segmentation": {
      "$ref": "#/$defs/IrisSegmentationConfig",
      "description": "Define the parameters for the segmentation mode."
    }
  },
  "required": [
    "name",
    "images",
    "classes",
    "views",
    "view_groups",
    "segmentation"
  ],
  "title": "IrisConfig",
  "type": "object"
}
